<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>5x5 Slot Machine</title>
<style>
body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #1e1e2f;
    color: #fff;
    padding: 2rem;
    position: relative;
}

h1 {
    color: #ffcc00;
    margin-bottom: 1rem;
}

#balance {
    margin-bottom: 1rem;
    font-size: 1.2rem;
}

#slot-container {
    position: relative;
    display: inline-block;
}

#slot-grid {
    display: grid;
    grid-template-columns: repeat(5, 80px);
    grid-template-rows: repeat(5, 80px);
    gap: 10px;
    justify-content: center;
    margin-bottom: 1.5rem;
}

.cell {
    background: #222;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 2rem;
    border-radius: 8px;
    transition: transform 0.3s, background 0.3s;
}

.cell.win {
    background: gold;
    transform: scale(1.2);
}

#spin-btn {
    padding: 15px 30px;
    font-size: 1.2rem;
    background: #ffcc00;
    color: #1e1e2f;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: background 0.3s;
    margin-top: 1rem;
}

#spin-btn:hover {
    background: #ffd633;
}

#message {
    margin-top: 1rem;
    font-size: 1.2rem;
}

#payline-canvas {
    position: absolute;
    top: 0;
    left: 0;
    pointer-events: none;
}
</style>
</head>
<body>

<h1>5x5 Slot Machine</h1>
<div id="balance">Balance: 100 Coins</div>
<div id="slot-container">
    <div id="slot-grid"></div>
    <canvas id="payline-canvas" width="450" height="450"></canvas>
</div>
<button id="spin-btn">Spin</button>
<div id="message"></div>

<script>
const rows = 5;
const cols = 5;
const balanceEl = document.getElementById('balance');
const gridEl = document.getElementById('slot-grid');
const spinBtn = document.getElementById('spin-btn');
const messageEl = document.getElementById('message');
const paylineCanvas = document.getElementById('payline-canvas');

let balance = 100;
const spinCost = 1;
let paylineInterval;

// Symbols with scoring
const symbols = [
    {icon:'üçí', score:1},
    {icon:'üçã', score:1},
    {icon:'üçä', score:2},
    {icon:'‚≠ê', score:3},
    {icon:'7', score:5},
    {icon:'üîî', score:2},
    {icon:'üíé', score:4},
    {icon:'üçâ', score:2},
    {icon:'üçá', score:1},
    {icon:'üçÄ', score:3}
];

// Paylines (indices of grid cells)
const paylines = [
// Horizontal lines (rows)
    [0,1,2,3,4],      // Top row
    [5,6,7,8,9],      // 2nd row
    [10,11,12,13,14], // Middle row
    [15,16,17,18,19], // 4th row
    [20,21,22,23,24], // Bottom row

    // Diagonals starting from left
    [0,6,12,18,24],   // Top-left to bottom-right
    [20,16,12,8,4],     // Bottom-left to top-righ

    // Zigzag / angled lines 
    [0,6,12,8,4],   // Left-top to middle to right top
    [20,16,12,18,24],   // left-bot to middle to right bot 
    [0,6,7,8,4],   // Left top with second 3 with right top
    [20,16,17,18,24],   // Left bottom with second 3 with right bottom
];

// Initialize grid
const grid = [];
for(let i=0;i<rows*cols;i++){
    const cell = document.createElement('div');
    cell.classList.add('cell');
    cell.textContent = '';
    gridEl.appendChild(cell);
    grid.push(cell);
}

// Animate spin column by column
function animateSpin(finalSymbols) {
    return new Promise(resolve => {
        let colIndex = 0;

        function spinColumn(col) {
            let spinCount = 0;
            const interval = setInterval(() => {
                for(let row=0; row<rows; row++){
                    const idx = row*cols + col;
                    grid[idx].textContent = symbols[Math.floor(Math.random()*symbols.length)].icon;
                }
                spinCount++;
                if(spinCount > 15){
                    clearInterval(interval);
                    for(let row=0; row<rows; row++){
                        const idx = row*cols + col;
                        grid[idx].textContent = finalSymbols[idx].icon;
                        grid[idx].classList.remove('win');
                    }
                    colIndex++;
                    if(colIndex < cols){
                        spinColumn(colIndex);
                    } else {
                        resolve();
                    }
                }
            }, 50);
        }

        spinColumn(colIndex);
    });
}

// Draw payline on canvas
function drawPayline(line){
    const ctx = paylineCanvas.getContext('2d');
    ctx.clearRect(0,0,paylineCanvas.width,paylineCanvas.height);
    ctx.strokeStyle = 'rgba(255,0,0,0.7)';
    ctx.lineWidth = 4;
    ctx.beginPath();
    const startCell = grid[line[0]];
    ctx.moveTo(startCell.offsetLeft + startCell.offsetWidth/2, startCell.offsetTop + startCell.offsetHeight/2);
    for(let i=1;i<line.length;i++){
        const c = grid[line[i]];
        ctx.lineTo(c.offsetLeft + c.offsetWidth/2, c.offsetTop + c.offsetHeight/2);
    }
    ctx.stroke();
}

// Animate all winning lines in a loop
function animateWinningLines(winningLines){
    if(paylineInterval) clearInterval(paylineInterval);
    if(winningLines.length===0){
        const ctx = paylineCanvas.getContext('2d');
        ctx.clearRect(0,0,paylineCanvas.width,paylineCanvas.height);
        return;
    }
    let index = 0;
    paylineInterval = setInterval(()=>{
        drawPayline(winningLines[index]);
        index = (index + 1) % winningLines.length;
    },1000);
}

// Animate balance increment
function animateBalance(oldBalance, newBalance){
    const increment = newBalance > oldBalance ? 1 : -1;
    let current = oldBalance;
    return new Promise(resolve => {
        const interval = setInterval(()=>{
            current += increment;
            balanceEl.textContent = `Balance: ${current} Coins`;
            if(current === newBalance){
                clearInterval(interval);
                resolve();
            }
        },50);
    });
}

// Spin function
async function spin(){
    if(balance < spinCost){
        messageEl.textContent = 'Not enough coins to spin!';
        return;
    }

    if(paylineInterval) clearInterval(paylineInterval);
    const ctx = paylineCanvas.getContext('2d');
    ctx.clearRect(0,0,paylineCanvas.width,paylineCanvas.height);

    const oldBalance = balance;
    balance -= spinCost;
    balanceEl.textContent = `Balance: ${balance} Coins`;
    messageEl.textContent = '';

    // Generate random symbols
    const finalSymbols = [];
    for(let i=0;i<rows*cols;i++){
        finalSymbols.push(symbols[Math.floor(Math.random()*symbols.length)]);
    }

    await animateSpin(finalSymbols);

    let totalWin = 0;
    const winningLines = [];

    paylines.forEach(line=>{
        const lineSymbols = line.map(idx => finalSymbols[idx]);
        const firstSym = lineSymbols[0].icon;
        let matchCount = 1;

        for(let i=1;i<lineSymbols.length;i++){
            if(lineSymbols[i].icon===firstSym){
                matchCount++;
            } else break;
        }

        if(matchCount>=3){
            winningLines.push(line);
            const lineScore = lineSymbols[0].score * matchCount;
            totalWin += lineScore;
            for(let i=0;i<matchCount;i++){
                grid[line[i]].classList.add('win');
            }
        }
    });

    if(totalWin>0){
        await animateBalance(balance, balance + totalWin);
        balance += totalWin;
        messageEl.textContent = `üéâ You won ${totalWin} coins!`;
    } else {
        messageEl.textContent = 'üò¢ No win, try again!';
    }

    animateWinningLines(winningLines);
}

spinBtn.addEventListener('click', spin);
</script>
</body>
</html>
